{"ast":null,"code":"import { connectToDatabase } from \"../../../lib/db\";\nimport { hashPassword } from \"../../../lib/auth\";\n\nasync function handler(req, res) {\n  if (req.method !== \"POST\") {\n    return;\n  }\n\n  const data = req.body;\n  const {\n    email,\n    password\n  } = data;\n\n  if (!email || !email.includes(\"@\") || !password || password.trim().length < 7) {\n    res.status(422).json({\n      message: \"Invalid input - password should also be at least 7 characters long\"\n    });\n    return;\n  }\n\n  const client = await connectToDatabase();\n  const db = client.db();\n  const existingUser = await db.collection(\"users\").findOne({\n    email: email\n  });\n\n  if (existingUser) {\n    res.status(422).json({\n      message: \"User exists already\"\n    });\n    client.close();\n    return;\n  }\n\n  const hashedPassword = await hashPassword(password);\n  const result = await db.collection(\"users\").insertOne({\n    email: email,\n    password: hashedPassword\n  });\n  res.status(201).json({\n    message: \"Created user!\"\n  });\n  client.close();\n}\n\nexport default handler;","map":null,"metadata":{},"sourceType":"module"}